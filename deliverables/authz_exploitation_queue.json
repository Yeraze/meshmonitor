{
  "vulnerabilities": [
    {
      "ID": "AUTHZ-VULN-01",
      "vulnerability_type": "Horizontal",
      "externally_exploitable": true,
      "endpoint": "GET /api/messages/direct/:nodeId1/:nodeId2",
      "vulnerable_code_location": "server.ts:1807",
      "role_context": "Any authenticated user with messages:read permission",
      "guard_evidence": "Generic permission check (messages:read) without node-specific ownership validation. No verification that user is participant in conversation.",
      "side_effect": "Read ALL direct messages between any two nodes regardless of user's relationship to those nodes",
      "reason": "Permission system checks for generic messages:read capability but does not validate user's relationship to the specific nodes. Database query has no user-specific filtering.",
      "minimal_witness": "1) Login as user with messages:read permission. 2) Call GET /api/messages/direct/!NODE1/!NODE2 with any node IDs. 3) Observe DMs returned without ownership check.",
      "confidence": "high",
      "notes": "The application has no concept of node ownership or user-to-node relationships. Any user with messages:read can enumerate and read all DM conversations."
    },
    {
      "ID": "AUTHZ-VULN-02",
      "vulnerability_type": "Horizontal",
      "externally_exploitable": true,
      "endpoint": "GET /api/telemetry/:nodeId",
      "vulnerable_code_location": "server.ts:3167",
      "role_context": "Any authenticated user with info:read or dashboard:read permission",
      "guard_evidence": "Generic permission check (info:read OR dashboard:read) without node-specific validation. Only location data protected if positionOverrideIsPrivate flag set.",
      "side_effect": "Read telemetry data (battery, temperature, signal strength, voltage, etc.) for any node in the system",
      "reason": "Permission check validates generic info/dashboard read access but does not verify user should access this specific node's telemetry. Database query filters only by nodeId parameter.",
      "minimal_witness": "1) Login as user with info:read permission. 2) Call GET /api/telemetry/ANY_NODE_ID. 3) Observe telemetry returned without node ownership check.",
      "confidence": "high",
      "notes": "Non-location telemetry always exposed. Location telemetry only protected if node explicitly marked as private via positionOverrideIsPrivate flag."
    },
    {
      "ID": "AUTHZ-VULN-03",
      "vulnerability_type": "Horizontal",
      "externally_exploitable": true,
      "endpoint": "GET /api/channel-database/:id",
      "vulnerable_code_location": "channelDatabaseRoutes.ts:146",
      "role_context": "Any admin user",
      "guard_evidence": "Only checks isAdmin flag. No ownership validation despite createdBy field existing in schema. Permissions table exists but not enforced.",
      "side_effect": "Read channel encryption keys (PSKs) created by other admins, enabling decryption of other admins' private channels",
      "reason": "Channel database entries have createdBy field tracking ownership but it's never used in authorization logic. Admin check alone is insufficient for multi-admin deployments.",
      "minimal_witness": "1) Admin A creates channel DB entry (ID=5). 2) Admin B calls GET /api/channel-database/5. 3) Admin B receives encryption key without ownership check.",
      "confidence": "high",
      "notes": "Critical for multi-admin deployments. Violates separation of duties. channel_database_permissions table exists but is not enforced in CRUD operations."
    },
    {
      "ID": "AUTHZ-VULN-04",
      "vulnerability_type": "Horizontal",
      "externally_exploitable": true,
      "endpoint": "PUT /api/channel-database/:id",
      "vulnerable_code_location": "channelDatabaseRoutes.ts:472",
      "role_context": "Any admin user",
      "guard_evidence": "Only checks isAdmin flag. No ownership validation. Update query has no user-based filtering.",
      "side_effect": "Modify or replace encryption keys for channels created by other admins, breaking their decryption capabilities",
      "reason": "Same architectural flaw as AUTHZ-VULN-03. Any admin can modify any channel database entry regardless of creator.",
      "minimal_witness": "1) Admin A creates channel DB entry. 2) Admin B calls PUT /api/channel-database/:id with malicious PSK. 3) Admin A's channel key replaced without authorization.",
      "confidence": "high",
      "notes": "Enables insider attacks. Admin B could disable channel (isEnabled:false) for DoS or replace PSK to break Admin A's monitoring."
    },
    {
      "ID": "AUTHZ-VULN-05",
      "vulnerability_type": "Horizontal",
      "externally_exploitable": true,
      "endpoint": "DELETE /api/channel-database/:id",
      "vulnerable_code_location": "channelDatabaseRoutes.ts:541",
      "role_context": "Any admin user",
      "guard_evidence": "Only checks isAdmin flag. No ownership validation before deletion.",
      "side_effect": "Permanently delete channel encryption keys created by other admins, causing loss of historical decryption capability",
      "reason": "Same architectural flaw as AUTHZ-VULN-03 and AUTHZ-VULN-04. Deletion has no ownership or permission checks beyond admin role.",
      "minimal_witness": "1) Admin A maintains critical channel DB entries. 2) Admin B calls DELETE /api/channel-database/:id. 3) Admin A's channel config permanently deleted.",
      "confidence": "high",
      "notes": "Destructive operation with no recovery path. Affects all historical message decryption for that channel."
    },
    {
      "ID": "AUTHZ-VULN-06",
      "vulnerability_type": "Context_Workflow",
      "externally_exploitable": true,
      "endpoint": "POST /api/scripts/test and script trigger execution",
      "vulnerable_code_location": "server.ts:8522 (test), meshtasticManager.ts:8367-8500 (execution)",
      "role_context": "Users with settings:read (for test) or settings:write (for triggers)",
      "guard_evidence": "Scripts stored in shared directory without user ownership. No validation that requesting user uploaded the script. Test endpoint allows any user with settings:read to execute any script.",
      "side_effect": "Cross-user script execution - User A can test and configure triggers for scripts uploaded by User B",
      "reason": "No user ID or ownership tracking when importing scripts. Script execution references path only, not uploader. No database table tracks script ownership.",
      "minimal_witness": "1) User A uploads script via POST /api/scripts/import. 2) User B calls POST /api/scripts/test with User A's script filename. 3) Script executes without ownership check.",
      "confidence": "high",
      "notes": "Enables script hijacking. User A cannot prevent User B from using their scripts. No accountability for malicious script execution. Auto-responder/geofence/timer triggers can reference any uploaded script."
    },
    {
      "ID": "AUTHZ-VULN-07",
      "vulnerability_type": "Context_Workflow",
      "externally_exploitable": true,
      "endpoint": "DELETE /api/users/:id/permanent",
      "vulnerable_code_location": "userRoutes.ts:250-264 (check) + 267-273 (delete)",
      "role_context": "Admin users",
      "guard_evidence": "Last admin protection checks admin count before deletion but lacks transactional guarantee. Race condition window between check and delete.",
      "side_effect": "Complete lockout - concurrent admin deletions can bypass last-admin protection, resulting in zero active admins",
      "reason": "Lines 252-257 query admin count, lines 267-273 delete user. No database lock or transaction. Concurrent requests can both pass the check and delete different admins simultaneously.",
      "minimal_witness": "1) Ensure exactly 2 active admins exist. 2) Send concurrent DELETE requests for both admins. 3) Both pass admin count check. 4) Both deletions complete, leaving 0 admins.",
      "confidence": "high",
      "notes": "Time-of-check-time-of-use race condition. More severe in multi-instance deployments. Also affects soft-delete endpoint which has NO last-admin check at all (lines 172-219)."
    },
    {
      "ID": "AUTHZ-VULN-08",
      "vulnerability_type": "Context_Workflow",
      "externally_exploitable": true,
      "endpoint": "DELETE /api/users/:id (soft delete)",
      "vulnerable_code_location": "userRoutes.ts:172-219",
      "role_context": "Admin users",
      "guard_evidence": "Soft-delete endpoint completely missing protections for last-admin and anonymous user. Only checks cannot-delete-self.",
      "side_effect": "Deactivate the anonymous user (system account) or deactivate the last admin via soft-delete, bypassing protections only present in permanent delete endpoint",
      "reason": "Permanent delete endpoint has anonymous protection (line 244) and last-admin protection (lines 250-264). Soft-delete endpoint has neither. Can deactivate anonymous user or last admin.",
      "minimal_witness": "1) Find anonymous user ID. 2) Call DELETE /api/users/:id (soft delete) for anonymous user. 3) Anonymous user deactivated without protection check.",
      "confidence": "high",
      "notes": "Critical oversight. Anonymous user deactivation breaks unauthenticated access. Last admin deactivation creates lockout. Protection only exists in permanent delete, not soft delete."
    }
  ]
}